function showThumb(a){if(a[0]){var b=".vimeo-"+a[0].id;$(b).each(function(){$(this).attr("src",a[0].thumbnail_medium)})}}function vimeoLoadingThumb(a){var b="http://vimeo.com/api/v2/video/"+a+".json?callback=showThumb",c=".vimeo-"+a;$(c).each(function(){$(this).before('<script type="text/javascript" src="'+b+'"></script>')})}view={_lang:void 0,getLang:function(){return void 0===this._lang&&$(function(){this._lang=$("#top-body").data("lang")?$("#top-body").data("lang"):"ru"}),this._lang},translate:function(a){var b=this.getLang();return"ru"!=b&&void 0!=a&&""!=a&&void 0!=window.Translate?Translate[a]||a:a},query:function(a,b,c,d,e,f,g){var h=e||"json",i=d||{},j=g||{};$.ajax({url:a,type:"POST",dataType:h,data:i,timeout:3e4,success:function(a,d){try{if(a&&1==a.success)b(a,d);else if(void 0!=f&&f(a,d),void 0==f||void 0!=j.showError&&1==j.showError){var e;if(e=j.msg?j.msg:"json"==h?void 0!=a.msg?a.msg:"":$(a).closest(".block-error").length>0?$(a).html():"",!a.type||"warning"!=a.type)throw new Error(e);ntNotification.showWarning(a.message),Popup.progressBar("hide")}}catch(g){Notifier.showError(g.message,c)}},error:function(a,b){var d=Notifier.getErrorTpl(b);Notifier.showError(d,c),Popup.progressBar("hide")}})},scrollTo:function(a,b){if(0==$("#"+a).length)return!1;b=500|b;var c=$("#"+a).offset();return $("body, html").animate({scrollTop:c.top},b),!0},toogleBlockByClick:function(a,b){var c=$(a);$(document).on("click",c.selector,function(){return $(b).toggle(),!1})},array_unique:function(a){for(var b=[],c=a.length,d=0;c>d;d++){for(var e=d+1;c>e;e++)a[d]===a[e]&&(e=++d);b.push(a[d])}return b},isInt:function(a){return!isNaN(a)&&parseInt(a)==a&&!/^0[x|X]\.*/i.test(a)&&a>=0},getTld:function(){return $("body").data("tld")},setPhoneValidator:function(){var a=view.getTld(),b=/^$/i;switch(a){case"ru":b=/^\+7\(\d{3}\)\d{7}$/i;break;case"ua":b=/^\+380\(\d{3}\)\d{7}$/i}return jQuery.validator.addMethod("phoneNumber",function(a,c){return this.optional(c)||b.test(a)},this.translate("Введите корректный телефон")),!0}};var Notifier={ask:function(a){return confirm(a)},addPreloader:function(a){0==$(a).find(".preloader").length&&(a.append('<div class="bg">'),a.append('<div class="preloader">'))},removePreloader:function(a){0!=$(a).find(".preloader").length&&(a.find(".bg").remove(),a.find(".preloader").remove())},hasPreloader:function(a){return 0!=$(a).find(".preloader").length},getErrorTpl:function(a){return view.translate("Ошибка")+": "+a+"."+view.translate("Попробуйте запрос позже")+"."},_showPopup:function(a){var b=this;b.popupTemlate?b._initPopup(a):$.get("/html/ru_RU/utils/notifyer.html",function(c){b.popupTemlate=c,$(document).on("click",".window.notifyer .-btn",function(){Popup.closeDialog()}),$(document).on("click",".window.notifyer a",function(){return Popup.closeDialog(),b.to_href=$(this).attr("href"),!1}),b._initPopup(a)})},_initPopup:function(a){var b=this,c=$(this.popupTemlate);c.find(".header").html(a.head),c.find(".message").html(a.msg),c.addClass(a.type),c.find(".-btn").addClass("-btn-"+a.type);var d=Popup.getParams();d.padding=0,d.afterClose=function(){b.to_href&&(window.location.href="http://"+window.location.host+b.to_href,$(document).trigger("hashchange")),b.to_href=!1},Popup.showDialog(c,d)},showError:function(a,b,c,d){var e=this;c=void 0==c?!0:c,a=a?a:"Произошла ошибка. Попробуйте еще.",a=view.translate(a),d=d?d:"Произошла ошибка",d=view.translate(d),void 0!=b&&$(b).length>0?e.notify({type:"error",msg:a,el:b,hide:c}):e._showPopup({head:d,msg:a,type:"error"})},showSuccess:function(a,b,c,d){var e=this;c=void 0==c?!0:c,a=a?a:view.translate("Операция выполнена успешно"),a=view.translate(a),d=d?d:"Операция выполнена успешно",d=view.translate(d),void 0!=b&&$(b).length>0?this.notify({type:"success",msg:a,el:b,hide:c}):e._showPopup({head:d,msg:a,type:"success"})},showWarning:function(a,b,c,d){var e=this;a=a?a:view.translate("Предупреждение"),a=view.translate(a),d=d?d:"Уведомление",d=view.translate(d),e._showPopup({head:d,msg:a,type:"warning"})},showMessage:function(a,b,c,d){var e=void 0==c?!0:c;void 0!=b&&$(b).length>0?(d=d||void 0,this.notify({type:"ok",msg:a,el:b,hide:e,speedOut:d})):void 0!=a&&alert(a)},notify:function(a){var b=this.getTemplate();1==a.hide&&$("."+$(b).attr("class")).fadeOut(),$(b).addClass(a.type).html('<table><td><div id="'+a.type+'-icon"></div></td><td>'+a.msg+"</td></table>"),$(a.el).prepend($(b)),$(b).fadeIn();var c=$(a.el).position().top,d=$(a.el).scrollTop();if(d>0&&$("body,html").animate({scrollTop:c},200),1==a.hide){var e=a.speedOut||5e3;setTimeout(function(){$(b).fadeOut(),$(b).remove()},e)}},getTemplate:function(){return $('<div class="notifier"/>')},showIndicator:function(a,b){var c=this.getIndicatorBtn(a,b);this.showIndicatorBtn(c)},hideIndicator:function(a,b){var c=this.getIndicatorBtn(a,b);this.hideIndicatorBtn(c)},lockBtn:function(a){a.hasClass("disable")||a.addClass("disable")},unlockBtn:function(a){a.removeClass("disable")},showIndicatorBtn:function(a){a.attr("style","width:"+a.innerWidth()+"px"),a.addClass("locked"),a.prepend('<div class="-loader"></div>'),a.on("click.off",function(){return!1})},hideIndicatorBtn:function(a){a.removeClass("locked"),a.children(".-loader").remove(),a.attr("style",""),a.off("click.off")},getIndicatorBtn:function(a,b){var c=b||!1;return $(0==c?0==$("#"+a+" button.blue, #"+a+" .-btn-complete").length?"#"+a+" .buttons.green-btn":"#"+a+" button.blue,#"+a+" .-btn-complete":"#"+a+" footer button.blue, #"+a+" footer .-btn-complete")},getLoader:function(){return'<div id="ajax-loader"></div>'},showNotice:function(a,b,c){var d=$(a);if(d.length>0){var e=$('<div id="user-notice" style="display:none;">'+b+"</div>"),f=d.find("#user-notice");c&&f.length?f.eq(0).replaceWith(e):d.append(e),e.fadeIn(200),setTimeout(function(){e.fadeOut(200,function(){e.remove()})},2500)}},getSmallLoader:function(){return"<img id='lazy-loader' src='/img/lazyload.gif'>"},removeSmallLoader:function(){$("#lazy-loader").remove()}},Popup={loadEvents:function(){var a=this;$(document).on("click",".window .close, .window .close-link a, .window .cancel,.window .-btn-cancel",function(){return 0==$(this).parents("#comment_form").length&&(a.closeDialog(),$.jPicker&&$.jPicker.List.forEach(function(a){a.hide()})),!1})},getParams:function(){return{closeBtn:!1,enableEscapeButton:!0,margin:0,padding:2,scrolling:!1,minHeight:1,minWidth:1}},showDialog:function(a,b){var c=this,d=b||c.getParams();d=$.extend({},d,{content:a}),Visitor.bindImageViewer($,d)},showWindow:function(a,b,c,d){var e='<section class="window '+c+'" id="'+c+'-edit-window" style="width:'+d+'px"><header><div class="edit-block"><ul><li><span class="close"></span></li></ul></div><h1>'+view.translate(b)+'</h1></header><div id="windowContent">'+a+"</div></section>";this.showDialog(e)},closeDialog:function(){$.fancybox.close()},progressBar:function(a){"show"==a?$.fancybox.showLoading():$.fancybox.hideLoading()},center:function(){}};Visitor={init:function(){this.setTooltip(),$("#footer").append($('<div id="temp-block"/>')),this.loadEvents(),this._initValidate(),this.decorateContent(),Popup.loadEvents();var a=$("#top-body").data("lang");this.lang=void 0==a?"ru":a,this.scrollWindow=0,this.isFancyLoad=!1,this.setSrcToFrameMap(),setTimeout(function(){Visitor.checkViewer()},1e3),this.addValidateMethods(),this.subscriberAddFormValidate(),this.initCatalogPriceFilter(),this.formsHashHandler(),$(window).on("hashchange",$.proxy(function(){this.formsHashHandler()},this)),OneClickBuy.init()},initCatalogPriceFilter:function(){var a=$("#catalog_price_filter");if(0!=a.length){var b=$("#catalog_price_filter_min_cost"),c=$("#catalog_price_filter_max_cost");$([b,c]).each(function(){$(this).change(function(){var a=isEmpty($(this).val())?0:$(this).val();$(this).data("user-input-rangeval",a)})});var d=void 0==b.data("min-cost")?0:parseInt(b.data("min-cost")),e=void 0==c.data("max-cost")?1e4:parseInt(c.data("max-cost"));a.noUiSlider({start:[""==b.val()?d:parseInt(b.val()),""==c.val()?e:parseInt(c.val())],range:{min:d,max:e},format:{to:function(a){return parseInt(a)},from:function(a){return a}},connect:!0}),a.Link("lower").to(b),a.Link("upper").to(c),$([b,c]).each(function(){$(this).change(function(){var a=parseInt(isEmpty($(this).val())?0:$(this).val()),b=parseInt($(this).data("user-input-rangeval"));a!=b&&$(this).val(b)})})}},setTooltip:function(){$(document).on("mouseover",".tooltip:not(.tooltipstered)",function(){var a=$(this);a.tooltipster({touchDevices:!1}),a.tooltipster("show")})},addValidateMethods:function(){$.validator.setDefaults({onclick:function(a){$(a).valid()&&$(a).removeClass("error")},onkeyup:function(a,b){(9!==b.which||""!==this.elementValue(a))&&$(a).valid()&&$(a).removeClass("error")}}),$.validator.addMethod("identity",function(a,b){var c=a.trim();return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(c)},view.translate("Введите корректный email"))},loadEvents:function(){var a=this;$(document).on("click",".ddelivery-map",function(){var a=$(this).data("city-type");Popup.showDialog('<iframe src="http://service.ddelivery.ru/demodev/ddelivery/ajax.php?iframe=1&amp;config_type=3&amp;width=900&amp;height=580&config_city='+a+'" height="600" width="920"></iframe>',{closeBtn:!1,enableEscapeButton:!0,margin:0,padding:[20,0,0,20],scrolling:!1,minHeight:1,minWidth:1})}),a.scrllWidth=a.scrollbarWidth(),$(document).on("click",".mailerForm .send",function(){$(".mailerForm form").submit()}),$(document).on("click","#topcontacts .feedback-btn",function(b){return b.preventDefault(),a.changeLocationHash(this.hash),Feedback.init($(this).data("type")),!1}),$(document).on("click","#up-link",function(b){return a.scrollTop(b)}),$(document).on("mouseover","#up-link",function(){$(this).stop(!0,!0).animate({opacity:1},200)}),$(document).on("mouseout","#up-link",function(){$(this).stop(!0,!0).animate({opacity:.4},200)}),$(window).scroll(function(){a.showUpLink(this)}),$(document).on("click",".buttons.order",function(){return a.changeLocationHash("#order-form"),a.makeOrder(this)}),document.onkeydown=function(b){a.keyEvents(b)},$(document).on("mouseover.fancy",".fancy-img",function(){return a.bindImageViewer($(".fancy-img"),{beforeShow:function(){$(".fancybox-skin").addClass("site-popup")}}),$(document).off("mouseover.fancy",".fancy-img"),!1}),$(document).on("click",".fancy-img-post",function(){$(this).parent().is("a")||a.bindImageViewer($,{href:$(this).attr("data-eval"),beforeShow:function(){$(".fancybox-skin").addClass("site-popup")}})}),$(document).on("click",".video-intext",function(){a.getVideo(this)}),$(document).on("click",".buttons.disable",function(){return!1}),$(document).on("click",".video-item a, .video-link",function(){a.showVideo($(this))}),$(document).on("click","#fancybox-main:not(.not-close)",function(a){a.target==this&&$.fancybox.close()}),$(document).on("click","#contactsmain-left .ymap, #contactsmain .ymap, #contactsmain-left .gmap, #contactsmain .gmap, #contactsmain-left .2gismap, #contactsmain .2gismap",function(){return a.findAddress(this),!1}),$(document).on("click","#sharebyemail-edit-window footer .save",function(){$("form#sharebyemail").submit()}),$(document).on("click",".error-window .ok,.success-window .ok",function(){Popup.closeDialog()}),$(document).on("click",".top-news .popup",function(){return a.getUrgentMessage()}),$(document).on("click","#blog-posts-lnk",function(){return a.setPostCounterNull()}),$(document).on("change","select#translate",function(){return a.toggleLanguage(this)}),$(document).on("click",".fancybox-wrap .show-form a",function(){return $(this).parent().parent().find("form").slideToggle(),!1}),$(document).on("click",".fancybox-wrap #comment_wrap .show-all",function(){$(this).remove(),$(".fancybox-wrap .comment_wrap").show()}),$(document).on("click","#fancybox-right.photos",function(){$(".album-items-wrap li.curr-"+$(this).data("next")).trigger("click")}),$(document).on("click","#fancybox-left.photos",function(){$(".album-items-wrap li.curr-"+$(this).data("prev")).trigger("click")}),this.viewPhoto(),$(document).on("click",".share-links a:not(.mail-average-icon)",function(){a.ShareLinks(this)}),$(document).on("click",".share-links a.mail-average-icon",function(){a.getShareByMailForm($(this))});var b=$("#catalogsortable select[name=sort], #catalogsortable select[name=categoryId]").each(function(){var a=$(this);a.attr("data-current-val",a.val())});$(document).on("change",b.selector,function(a){var b=$(a.target);b.data("current-val")!=b.val()&&b.parents("form").submit()}),$(document).on("change","#catalogsortable input[type=checkbox]",function(){$(this).parents("form").submit()}),view.setPhoneValidator()},showVideo:function(a){var b=this;$.post(a.attr("data-video-href"),function(a){a.success?b.bindImageViewer($,{content:a.block,padding:0,className:"fancy-video",scrolling:!1,beforeShow:function(){$(".fancybox-skin").addClass("imageGallery");var c=$("#video-content .item-content").attr("id").replace("item","");a.nocomment||$.post("/get/commentswindow",{object:c,type:"video"},function(a){if(a.success){var c=$(a.block);c.hide(),$(".fancybox-inner .item-info").append(c),$(".fancybox-inner .item-info .comments-block").slideDown(),b.bindInputCharCounter(),Comments.validateWindowForm($(".fancybox-inner #comment_form")),"undefined"!=typeof CommentsUser&&CommentsUser.reloadEvents()}else ntNotification.showError("Произошла ошибка. Видео не найдено.")},"json")}}):ntNotification.showError("Произошла ошибка. Видео не найдено.")},"json")},getShareByMailForm:function(a){var b=this,c={id:a.attr("data-id"),type:a.attr("data-type"),token:a.attr("data-token")},d="/getmailform";$.post(d,c,function(a){a.success&&(Popup.showDialog(a.form),b.shareByMailFormValidate())})},shareByMailFormValidate:function(){$("form#sharebyemail").validate({submitHandler:function(a){return Notifier.showIndicator("sharebyemail"),$(a).ajaxSubmit({success:function(b){Notifier.hideIndicator("sharebyemail");try{if(b.success)Popup.showDialog(b.success_window);else if(void 0!=b.error)Popup.showDialog(b.error);else{if(b.error==a)throw new Error("");Popup.showDialog(b.form)}}catch(c){ntNotification.showError(c.message)}}}),!1},focusInvalid:!1,focusCleanup:!0,rules:{email:{required:!0,email:!0}},messages:{email:{required:view.translate("Пожалуйста, укажите email адрес"),email:view.translate("Введите корректный email")}},errorPlacement:function(a,b){error_item=b.parent().parent().find(".state_field"),a.appendTo(error_item)},highlight:function(a){$(a).attr("id");$(a).parent().parent().find(".state_field").addClass("red"),$(a).addClass("error")},unhighlight:function(a){$(a).parent().parent().find(".state_field").removeClass("red"),$(a).removeClass("error")}})},ShareLinks:function(a){var b=$(a).attr("href"),c=[560,472],d=screen.width?(screen.width-c[0])/2:0,e=screen.height?(screen.height-c[1])/2:0,f="height="+c[1]+",width="+c[0]+",top="+e+",left="+d+",scrollbars=yes,resizable";return window.open(b,"SocialNet",f),!1},getVideo:function(a){var b=this,c=$(a).prop("class").replace("video-intext ",""),d=$(a).prop("alt").replace(/<(\/)?(\s)*script(\s)*>/,""),e=$(a).prop("id").replace(/<(\/)?(\s)*script(\s)*>/,""),f=$(a).prop("title").replace(/<(\/)?(\s)*script(\s)*>/,""),g=b.VideoConfig[c].content.replace(/\#/g,e);g='<div id="video-content" style="width: 740px;" data-code="'+e+'"><div class="item-content"><header><h1>'+f+"</h1>"+g+'</header><div class="video-desc">'+d+"</div></div></div>",Visitor.bindImageViewer($,{content:g,padding:0})},VideoConfig:{youtube:{image:"http://img.youtube.com/vi/?/default.jpg",regexp:/(?:(?:youtube\.com\/watch\?(?:[\w\d]+\=[\w\d]+\&)*v\=)|(?:youtu\.be\/)|(?:youtube\.com\/user\/[\w\d]+(?:\?(?:[\w\d]+\=[\w\d]+[\&]?)+)?#p\/(?:[\w]\/){0,4}[\d]+\/))([_a-zA-Z0-9-]+)/i,content:'<iframe width="700" height="390" src="http://www.youtube.com/embed/#?rel=0" frameborder="0" allowfullscreen></iframe>'},youtu:{image:"http://img.youtube.com/vi/?/default.jpg",regexp:/(?:(?:youtube\.com\/watch\?(?:[\w\d]+\=[\w\d]+\&)*v\=)|(?:youtu\.be\/)|(?:youtube\.com\/user\/[\w\d]+(?:\?(?:[\w\d]+\=[\w\d]+[\&]?)+)?#p\/(?:[\w]\/){0,4}[\d]+\/))([_a-zA-Z0-9-]+)/i,content:'<iframe width="700" height="390" src="http://www.youtube.com/embed/#?rel=0" frameborder="0" allowfullscreen></iframe>'},rutube:{image:"http://tub.rutube.ru/thumbs-wide/?-2.jpg",regexp:/(?:(?:rutube\.ru\/tracks\/[0-9]+\.html\?v\=)|(?:video\.rutube\.ru\/))([_a-zA-Z0-9]+)/i,content:'<iframe width="700" height="390" src="http://rutube.ru/video/embed/#" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>'},vimeo:{image:"",regexp:/vimeo\.com\/([0-9]+)/i,content:'<iframe src="http://player.vimeo.com/video/#?title=0&amp;byline=0&amp;portrait=0" width="700" height="390" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}},showUpLink:function(a){var b=document.body.clientWidth,c=$("#up-link");b>1100&&$(a).scrollTop()>400?c.fadeIn():c.fadeOut(200)},scrollTop:function(a){return $("body,html").animate({scrollTop:0},200),a.preventDefault(),!1},keyEvents:function(a){if(a=a||window.event,27==a.keyCode){var b=$(".on-edit:not(.static)").not("#comment-edit");b.length>0&&Site.toggleBlock(),$.jPicker&&$.jPicker.List.forEach(function(a){a.hide()})}},decorateContent:function(){$(document).on("widget_init",function(){$("#content").find(".user-inner li:not(:has(i.circles))").prepend('<i class="circles"></i>')}),$("#content").find(".user-inner li:not(:has(i.circles))").prepend('<i class="circles"></i>')},makeOrder:function(a){$forOrder=$(a).parents(".content-block").attr("id").replace("-show","");var b=$(a).parents(".item-content"),c="";return b.length>0&&(c=$(b).attr("id").replace("item","")||""),Feedback.init($forOrder,{sid:c,order:!0})},_initValidate:function(){$.validator.setDefaults({showErrors:function(a,b){return b.length<1?void $("ul.errors").remove():void $.each(b,function(a,b){var c=$(b.element);c.removeClass("valid").addClass("error"),c.is('input[type="checkbox"]')||(c.removeClass("valid").addClass("error"),c.next("ul.errors").remove(),c.after($("<ul/>").addClass("errors").append($("<li/>").text(b.message))))})}})},preloadBannerImages:function(a){if("undefined"!=typeof document.body)try{$("#banner-carousel").html(Notifier.getLoader());var b=document.createElement("div"),c=b.style;c.position="absolute",c.top=c.left=0,c.display="none",document.body.appendChild(b);for(var d in a){var e=document.createElement("img");e.src=a[d],b.appendChild(e)}BannerShow()}catch(f){}},ymaploaded:function(a){var b=$(a).attr("src");void 0!=b&&"about:blank"!=b&&$("#ymap-container #ajax-loader").remove()},findAddress:function(a){var b=$(a),c=b.prevAll(".address-value"),d=(c.html(),c.data("geolat"),c.data("geolng"),c.data("geozoom"));d=d||0;var e="ymap";b.hasClass("gmap")?e="gmap":b.hasClass("2gismap")&&(e="2gismap");var f=(b.data("host"),b.data("lang"),b.attr("href"));Popup.showDialog('<div id="map-container"><div id="ajax-loader"></div><iframe id="map-frame" width="600" height="450" marginheight="0" marginwidth="0" frameborder="0" src=""></iframe></div>',{closeBtn:!0,padding:10});var g=$("#map-frame");g.attr("src",f),g.load(function(){var a=$(this).attr("src");void 0!=a&&"about:blank"!=a&&$("#map-container #ajax-loader").remove()})},setSrcToFrameMap:function(){var a=$("#main-contacts .address ul iframe[id^=ymap-], #main-contacts .address ul iframe[id^=gmap-], #main-contacts .address ul iframe[id^='2gismap-']");return a.length&&a.each(function(){var a=$(this);if(void 0!=a.attr("src"))return!0;var b=a.attr("id"),c=b.replace(/-\d+/,"");"ymap"!=c&&"gmap"!=c&&"2gismap"!=c&&(c="ymap");var d=$(this).data("host"),e=$(this).data("lang"),f=$(this).prevAll("span.address-value").data("geolat"),g=$(this).prevAll("span.address-value").data("geolng"),h=$(this).prevAll("span.address-value").data("geozoom");h=h||0;var i=$(this).prevAll("span.address-value").html(),j="http://"+d+"/"+c+"/addr/"+i+"/"+h+"/w/550/h/300/embedded/"+e;void 0!=f&&void 0!=g&&(j="http://"+d+"/"+c+"/coords/"+f+";"+g+"/"+h+"/w/550/h/300/embedded/"+e),$(this).attr("src",j)}),!1},getUrgentMessage:function(){var a="/geturgentcontent",b={pid:$(".top-news").data("mid")},c=function(a){Popup.showDialog(a.content)};return view.query(a,c,null,b),!1},setPostCounterNull:function(){var a=$("#blog-counter");if(a.length>0){var b="/markpostread",c={type:"all"},d=function(){a.hide()};view.query(b,d,null,c)}},toggleLanguage:function(a){var b=$(a).val()||"ru";return view.query("/togglelang",function(a){void 0!=a.success&&1==a.success&&window.location.reload()},"",{lang:b}),!1},bindImageViewer:function(a,b){var c=this;if(void 0!==a&&a.length){var d=function(){};b=b||{},b.fitToView=!1,b.fixed=!1,b.scrolling=b.scrolling||"no",b.nextEffect="none",b.prevEffect="none",b.openEffect="fade",b.openSpeed="slow",b.minHeight=1,b.live=!0,b.minWidth=1,b.beforeShow&&(d=b.beforeShow);var e=function(){};b.afterLoad&&(e=b.afterLoad);var f=function(){};b.beforeLoad&&(f=b.beforeLoad);var g=function(){};b.afterClose&&(g=b.afterClose),b.beforeLoad=function(){return c.fancy=this,$.fancybox.showLoading(),f()},b.beforeShow=function(){"html"==c.fancy.type&&void 0==c.fancy.isGallery&&(c.fancy.height=$(".fancybox-inner").innerHeight()),$.fancybox.hideLoading();var a=$(window).height(),e=$("#main-wrapper");c.isFancyLoad||(c.scrollWindow=$(window).scrollTop(),e.css("margin-top","-"+c.scrollWindow+"px"),e.css("overflow","hidden").height(a+c.scrollWindow)),$(window).scrollTop(0),$("#fancybox-main").remove(),$("html, body").css("overflow","hidden").height($(window).height()),$("#wrapper").outerHeight()>$(window).height()&&e.css({"margin-right":c.scrllWidth+"px"});var f=$(".fancybox-wrap");f.addClass(b.className),f.addClass("imageviwer"),f.wrap('<div id="fancybox-main" style="overflow-y: scroll;"></div>'),$("#fancybox-main").height(a),$(window).resize(function(){$("#main-wrapper").css({height:$(window).height()+c.scrollWindow+"px"}),$("#fancybox-main").height($(window).height()),$("html, body").height($(window).height())});var g=b.href||c.fancy.href;if(g){var h;/(http:\/\/)*.*\/static\/img\/\d+\/\d+\/\d+\//.test(g)?(h=g.replace(/(http:\/\/)*.*\/static\/img\/\d+\/\d+\/\d+\//,""),h&&c.changeLocationHash("#img-"+h)):/http:\/\/.*\/video/.test(g)&&(h=g.replace(/http:\/\/.*\/video\//,""),h&&c.changeLocationHash("#video-"+h))}else{var i=this.content,j=$(i).closest("#video-content").data("code");j&&c.changeLocationHash("#video-c_"+j)}d(),c.isFancyLoad=!0},b.afterClose=function(a){$(window).unbind("resize"),$("#fancybox-main").remove();var b=$("#main-wrapper");if(b.css("height","100%"),b.css("margin-top","auto"),b.css({"margin-right":"0"}),b.css("overflow","inherit"),$("html, body").css("height","100%"),$("html, body").css("overflow",""),$(window).scrollTop(c.scrollWindow),window.location.hash.length>1)if(window.history&&window.history.replaceState){var d=window.location.pathname+window.location.search;window.history.replaceState({},"",d)}else window.location.hash=" ";g(a),c.isFancyLoad=!1},a.fancybox(b)}},scrollbarWidth:function(){var a=$("html"),b=a.css("overflow","hidden").width();return a.css("overflow","scroll"),b-=a.width(),b||(b=a.width()-a[0].clientWidth),a.css("overflow",""),b},checkViewer:function(){var a=window.location.hash;if(/^#img-.*$/.test(a)){var b=new RegExp(/^#img-([\w\.]+\.[a-z]{3,4})(?:\?\d+)?$/i),c=a.match(b);if(null===c)return;c=c[1];var d=new RegExp("^.*"+c+".*$");$("a.fancy-img, img.fancy-img-post, li.view-photo a").each(function(){$this=$(this);var a="";return $this.is("a")?a=$this.attr("href"):$this.is("img")&&(a=$(this).data("eval")),d.test(a)?($this.trigger("click"),!1):void 0})}else if(/^#video-\d*$/.test(a)){var e=a.match(/^#video-(\d+)$/);if(null===e)return;e=e[1];var d=new RegExp("^.*#video-"+e+".*$");$("a.video-link,.video-item a:not(.video-link)").each(function(){var a=$(this).attr("href");return d.test(a)?($(this).trigger("click"),!1):void 0})}else if(/^#video-c_\w+$/.test(a)){var f=a.match(/^#video-c_(\w+)$/);if(null===f)return;f=f[1],$("#"+f).trigger("click")}},changeLocationHash:function(a){window.history&&window.history.replaceState?window.history.replaceState({},"",a):window.location.hash=a},viewPhoto:function(){var a=this;return a.bindImageViewer($("#photoalbum-show .view-photo > a"),{beforeShow:function(){var b=$(a.fancy.element).attr("id").replace("view-","");a.fancy.autoHeight=!0,void 0!=a.getcomments&&a.getcomments.abort(),a.getcomments=$.post("/get/commentswindow",{object:b,type:"image"},function(b){if(b.success){var c=$(b.block);c.hide(),$(".fancybox-inner #windowContent #photo-header").append(c),$(".fancybox-inner #windowContent .comments-block").slideDown(),a.bindInputCharCounter(),Comments.validateWindowForm($(".fancybox-inner #comment_form")),"undefined"!=typeof CommentsUser&&CommentsUser.reloadEvents()}},"json")},afterLoad:function(){$(".fancybox-skin").addClass("imageGallery");var b=window.screen.availHeight-200,c=900,d=600;""!=$.trim($("#tmp-wrapper #view-photo-desc .text").text())&&$("#tmp-wrapper #view-photo-desc .placeDesc").hide();var e=a.fancy.width/a.fancy.height,f=0;1>e?f=a.fancy.height>b?e*b:a.fancy.width:(f=a.fancy.width>c?c:a.fancy.width,f/e>b&&(f=e*b));var g=f/e;a.fancy.tpl.next='<a style="top: 30px;height: '+g+'px" class="fancybox-nav fancybox-next"><span></span></a>',a.fancy.tpl.prev='<a style="top: 30px;height: '+g+'px" class="fancybox-nav fancybox-prev"><span></span></a>';var h=d>f?d:f,i=$("#tmp-wrapper #photo-src");i.width(f),i.height(g),$("#tmp-wrapper #photo-wrapper").width(f),$("#tmp-wrapper #windowContent").width(h),a.fancy.content=$("#tmp-wrapper").html(),a.fancy.width=h,$("#tmp-wrapper").remove(),a.fancy.type="html"},beforeLoad:function(){a.fancy.isGallery=!0;var b=$(a.fancy.element).parent();a.showImage=!1;var c=$("#photoview-tpl").html(),d=($(b).data("raw"),$(b).parents(".album-items-wrap")),e=$(b).data(),f=d.hasClass("homepage"),g=d.data();if(f){var h=$(b).find(".view-photo-href").data();g=$.extend(g,h)}for(id in e)c=c.replace(new RegExp("{:"+id+"}","g"),e[id]);for(alId in g)c=c.replace("{:"+alId+"}",g[alId]);$("#tmp-wrapper").length>0&&$("#tmp-wrapper").remove(),$('<div id="tmp-wrapper">'+c+"</div>").appendTo($("body"))},beforeClose:function(){}}),!1},getPhotos:function(a,b,c){var d="/photoalbum/load/getalbumphotos",e=function(a){var b=$(a.data).find("li.view-photo");if(b.length>0){b.css("display","none");var d=$("#photoalbum-show ul.album-items-wrap");c?d.append(b):d.prepend(b)}},f=function(){Notifier.hideIndicator("windowContent",!0)};return view.query(d,e,"#windowContent",{aid:a,page:b,isView:!0},"json",f,{showError:!0}),!1},charCounter:function(a,b,c,d){void 0!==d&&d===!1&&(a=a.replace(/(<\/?[^>]+>)|(&nbsp;)/gi,""));var e=b-a.length;0>e&&(e=0),c.html(e)},bindInputCharCounter:function(){var a=this,b='<span class="infoDigits char_info">'+view.translate("Осталось символов")+': <span class="char_limit"></span></span>';$("input, textarea:visible, #comment_form textarea").each(function(){var c,d=$(this),e=d.data("charcounter");if(c=d.attr("maxlength")){var f,g;if(d.parents("dd").length&&"no"!=e){g=d.attr("id");var h=d.parents("dl").find("dt#"+g+"-label");h.find("span.char_info").length||h.prepend(b),f=$("#"+g+"-label .char_info .char_limit")}else"yes"==e&&(g=d.attr("id"),d.parent().find("span.char_info").length||d.parent().prepend(b),f=d.parent().find("span.char_info .char_limit"));void 0!==g&&$("#"+g).unbind(".limit").bind("change.limit keyup.limit",function(){a.charCounter($(this).val(),c,f)}).triggerHandler("change.limit")}})},bindInputCharCounterByElement:function(a){var b,c=this,d='<span class="infoDigits char_info">'+view.translate("Осталось символов")+': <span class="char_limit"></span></span>',e=a.data("charcounter");if(b=a.attr("maxlength")){var f,g;if(a.parents("dd").length&&"no"!=e){g=a.attr("id");var h=a.parents("dl").find("dt#"+g+"-label");h.find("span.char_info").length||h.prepend(d),f=$("#"+g+"-label .char_info .char_limit")}else"yes"==e&&(g=a.attr("id"),a.parent().find("span.char_info").length||a.parent().prepend(d),f=a.parent().find("span.char_info .char_limit"));void 0!==g&&$("#"+g).unbind(".limit").bind("change.limit keyup.limit",function(){c.charCounter($(this).val(),b,f)}).triggerHandler("change.limit")}},subscriberAddFormValidate:function(){$('form#subscriber-add-form input[type="text"]:visible:not([placeholder])').focus(function(){var a=$(this),b=a.val(),c=a.data("default");b==c&&a.val("")}).blur(function(){var a=$(this),b=a.val(),c=a.data("default");""==b&&a.val(c)}),$("form#subscriber-add-form").validate({submitHandler:function(a){return Notifier.showIndicator("subscribe-left"),$(a).ajaxSubmit({success:function(a){Notifier.hideIndicator("subscribe-left");try{if(void 0!=a.form){var b=$(a.form).find('input[id*="csrf"]');b.length&&$("#subscriber-add-form").find('input[id*="csrf"]').replaceWith(b)}void 0!=a.success&&1==a.success?Popup.showDialog(a.success_window):ntNotification.showError("Ошибка при добавлении подписчика")}catch(c){ntNotification.showError(c.message)}}}),!1},focusInvalid:!0,focusCleanup:!1,errorClass:"error",rules:{name:{required:!0,minlength:1},email:{required:!0,email:!0}},messages:{name:{required:view.translate("Пожалуйста, укажите свое имя")},email:{required:view.translate("Пожалуйста, укажите email адрес"),email:view.translate("Введите корректный email")}}})},formsHashHandler:function(){var a,b=location.hash;void 0!==b&&""!==b&&null!==b&&(a=function(){switch(!0){case/\#(\/)?feedback/.test(b):return"a.feedback-btn[data-type=0]";case/\#(\/)?callback/.test(b):return"a.feedback-btn[data-type=1]";case/\#(\/)?order\-form/.test(b):return"button.order, .buttons.order";case/\#(\/)?one\-click\-form/.test(b):return"a.one-click-order-btn";default:return""}}.call(this),null!==$(a)&&$(a).length>0&&$(a).trigger("click"))}};var d=document,ie=d.all&&!window.opera,op="",OneClickBuy={selector:"a.one-click-order-btn",formSelector:"form.order-by-click",link:void 0,init:function(){$(this.selector).length>0&&this.initEventListener()},initEventListener:function(){var a=this;$(document).on("click",this.selector,function(b){b.preventDefault(),Nethouse.cart.grabParams(function(){a.openModal($(a.selector))})})},handleFormSubmit:function(){var a=$(this.formSelector).parents(".window").find("button.send"),b=this;a.length>0&&$(a).click(function(a){a.preventDefault(),$(b.formSelector).submit()})},openModal:function(a){var b=$(a).attr("data-product-id"),c=$(a).attr("href"),d=this,e=[];$("#product-params-view option:selected").each(function(){e.push(this.value)}),Nethouse.Modal.openHtmlAjax(c,{opts:{type:"POST",data:{productId:b,selectedParams:JSON.stringify(e)}},error:"Ошибка при загрузке формы",open:function(){d.addFieldsValidators(),d.handleFormSubmit()}})},addFieldsValidators:function(){$(this.formSelector).validate({focusInvalid:!1,focusCleanup:!0,rules:{clientName:{required:!0},clientPhone:{required:!0,phone:!0}},messages:{clientName:{required:view.translate("Введите корректное имя")},clientPhone:{required:view.translate("Введите номер телефона")}}})}};Feedback={init:function(a,b){return this.type=a,this.params=b||{},this.loadEvents(),this.showFeedback(),this.id="feedback"==a?"feedback-edit-window":"services-edit-window",!1},loadEvents:function(){},showFeedback:function(){var a,b=this;
if(this.params.order)a="/"+this.type+"/load/makeorder",this.params.type=this.type,c=this.params;else{a="/mailer/getform";var c={type:this.type}}return Nethouse.Modal.openHtmlAjax(a,{opts:{type:"POST",data:c},error:"Ошибка при загрузке формы",open:function(){$(b.windowId).addClass(b.type),b.submitFeedback($("#"+b.type+"-order-form"))}}),!1},submitFeedback:function(a){var b=this,c=$(a);return a.validate({submitHandler:function(a){var c=b.type+"-edit-window";Notifier.showIndicator(c,!0),$(a).ajaxSubmit({dataType:"json",success:function(a){Notifier.hideIndicator(c,!0);try{if(void 0!=a&&1==a.success)Nethouse.Modal.close();else{var d=a.msg||view.translate("Ошибка при отправке письма!");Notifier.showError(d,"#"+b.id+" #windowContent")}}catch(e){ntNotification.showError(e)}}})},focusInvalid:!1,focusCleanup:!0,rules:b.feedbackRules(a),messages:b.feedbackErrors(a)}),(c.is("#products-order-form")||c.is("#services-order-form"))&&b.initUploadFile(a),!0},initUploadFile:function(a){var b=this,c=["doc","docx","xls","xlsx","pdf","jpg","jpeg","gif","png","zip","rar"],d=$(a),e="fancybox-content";d.is("#products-order-form")?e="products-edit-window":d.is("#services-order-form")&&(e="services-edit-window");{var f=d.find(".attach-btn a"),g=b.getUid(),h="/documents/put?X-Progress-ID=";new AjaxUpload(f,{action:h+g,name:"uploadattachment",responseType:"json",onSubmit:function(a,i){g=b.getUid(),this._settings.action=h+g,Notifier.showIndicator(e);var j=c.join("|"),k=new RegExp("^("+j+")$");return i=i.toLowerCase(),i&&k.test(i)?void b.startProgressUpload(f,g):(Notifier.hideIndicator(e),Notifier.showError(view.translate("Поддерживаемые форматы")+": "+c.join(", ").toUpperCase()+".",d),!1)},onComplete:function(a,c){if(c.success&&1==c.success&&c.url){var f=c.url,g=c.name,h=c.size,i=c.timestamp;d.find("#attach-url").val(f),d.find("#attach-name").val(g),d.find("#attach-size").val(h),d.find("#attach-timestamp").val(i);var j=d.find(".attach-info .file-info");j.find(".attach-file-name").html(g);var k=b.getHumanReadableFileSize(h);j.find(".attach-file-size").html(k),j.parent().show(),d.find(".attach-btn").hide();var l=b.getFileIcon(g);l&&d.find(".file-icons").addClass(l)}Notifier.hideIndicator(e)}})}},getHumanReadableFileSize:function(a){a=parseInt(a);var b;return b=a>=1048576?Math.round(a/1048576*10)/10+" Мб":a>=1024?Math.round(a/1024*10)/10+" кб":a+" б"},getFileIcon:function(a){a=a.toLowerCase();var b={pdf:[/pdf$/],xls:[/xls$/,/xlsx$/],jpg:[/jpg$/,/jpeg$/],psd:[/psd$/],mp3:[/mp3$/],gif:[/gif$/],ai:[/ai$/],eps:[/eps$/],png:[/png$/],zip:[/zip$/],rar:[/rar$/],txt:[/txt$/],rtf:[/rtf$/],doc:[/doc$/,/docx$/],ppt:[/ppt$/,/pptx$/],djvu:[/djvu$/,/djvue$/],fb:[/fb$/],ps:[/ps$/]},c=null;for(var d in b){var e=b[d];for(var f in e)if(e[f].test(a)){c=d;break}}return c&&(c+="-icon"),c},getUid:function(a){a=a||32;for(var b=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],c="",d=0;a>d;d++){var e=Math.floor(16*Math.random())+0;c+=b[e]}return c},startProgressUpload:function(a,b){var c=this,d=$('<div id="progress"><div class="progressbar-value"></div></div>');$(a).after(d).css("display","none"),setTimeout(function(){c.updateProgress(b,d)},1e3)},updateProgress:function(id,progressbar,success){var _self=this;$.ajax({url:"/getprogress",timeout:3e3,headers:{"X-Progress-ID":id},dataType:"script",complete:function(){},error:function(){},success:function(data){var response=null;try{response=eval(data)}catch(e){response={}}var progress=0;if(void 0!=response.state)if(void 0!=success&&"function"==typeof success)success(response,id);else{if("uploading"==response.state){var size=response.size,received=response.received;progress=Math.floor(received/size*100),size!=received&&setTimeout(function(){_self.updateProgress(id,progressbar)},1e3)}else{if("starting"==response.state)return void setTimeout(function(){_self.updateProgress(id,progressbar)},500);"done"==response.state&&(progress=100)}progressbar.find(".progressbar-value").stop(!0).animate({width:parseInt(3*progress)+"px"},2e3)}}})},feedbackRules:function(a){var b=$(a).data("type"),c={FORM_TYPE_FEEDBACK:0,FORM_TYPE_CALLBACK:1,FORM_TYPE_ORDER:2},d={maxlength:1e3};"call"!=b&&(d.required=!0);var e={content:d,fio:{required:!0,maxlength:100},email:{required:!0,maxlength:50,email:!0},phone:{required:!0,maxlength:20}};switch(b){case"services":e.serviceName={required:!0};break;case"products":e.productName={required:!0},e.phone={phone:!0};break;case c.FORM_TYPE_FEEDBACK:e.phone={required:!1};break;case c.FORM_TYPE_CALLBACK:}return e},feedbackErrors:function(){var a={content:{maxlength:view.translate("Введено больше символов"),required:view.translate("Обязательное поле")},fio:{maxlength:view.translate("Введено больше символов"),required:view.translate("Обязательное поле")},email:{maxlength:view.translate("Введено больше символов"),required:view.translate("Обязательное поле"),email:view.translate("Неверный формат почты")},phone:{maxlength:view.translate(view.translate("Введено больше символов")),required:view.translate(view.translate("Обязательное поле"))}};switch(this.type){case"services":a.serviceName={required:view.translate("Выберите услугу")};break;case"products":a.productName={required:view.translate("Выберите товар")}}return a}},$(document).ready(function(){Visitor.init()});var Cart=function(){this.blockId="products",this.blockLeft="products-cart-left",this.orderBtn=$("#products").find(".buttons.cart"),this.orderForm="#product-order-form",this.pushUrl="/"+this.blockId+"/load/pushtocart",this.updateUrl="/"+this.blockId+"/load/updatecart",this.PROMOCODE_FORALL=0,this.PROMOCODE_PERCENT=1,this.PROMOCODE_CURRENCY=2,this.PROMOCODE_ARTICUL=3,this.promocode=null,this.loadEvents()};$.extend(Cart.prototype,{loadEvents:function(){var a=this,b=$(".payments-step");a.hasStore=b.length>0,a.order_info=$("#view-cart-show"),a.client_info=$("#user-info");var c=$("#top-body:not(.cabinet)"),d=function(){var b=$(".contacts-step"),c=$(".cart-step"),d=$(".pay-step");b.find(".separate").removeClass("arrow_step_fl").addClass("arrow_step_fr"),d.find(".separate").removeClass("arrow_step").addClass("arrow_step_fl"),c.removeClass("active"),b.addClass("active");var e=$("input.delivery-choose:checked");if(e.length){var f=parseInt(e.data("dlvr"));$("#product-order-form").find("#dlvrId").val(f)}a.client_info.show(),$("html,body").animate({scrollTop:$(".order-steps").offset().top-30},100),a.order_info.hide()};$(document).on("change",a.order_info.find("tr:not(.deleted-item) .num-items").selector,function(){return 0==a.order_info.find("tr:not(.deleted-item) .num-items.error").length&&a.order_info.find(".btn-contact-step").removeClass("disable"),a.update(this,"update",!0)}),$(document).on("click",a.order_info.find(".btn-contact-step:not(.disable)").selector,function(){return Cart.countUpdated?($(document).off("toContactStep"),$(document).on("toContactStep",function(){d()})):d(),!1}),$(".prev-step-contacts, .prev-step").keypress(function(){return!1}),a.hasStore&&($(document).on("click",a.client_info.find(".btn-payments-step").selector,function(){if($(a.orderForm).valid()){var c=$(".contacts-step"),d=($(".cart-step"),$(".pay-step"));c.find(".separate").removeClass("arrow_step_fr").addClass("arrow_step"),d.find(".separate").removeClass("arrow_step_fl").addClass("arrow_step_fr"),c.removeClass("active"),d.addClass("active"),b.show(),$("html,body").animate({scrollTop:$(".order-steps").offset().top-30},100),a.client_info.hide()}return!1}),$(document).on("click",b.find(".prev-step-contacts").selector,function(){var c=$(".contacts-step"),d=($(".cart-step"),$(".pay-step"));return c.find(".separate").removeClass("arrow_step").addClass("arrow_step_fr"),d.find(".separate").removeClass("arrow_step_fr").addClass("arrow_step_fl"),c.addClass("active"),d.removeClass("active"),b.hide(),a.client_info.show(),!1})),$(document).on("click",a.client_info.find(".prev-step").selector,function(){return a.toCartStep(),!1}),$(document).on("click",this.orderBtn.selector,function(){return a.grabParamsAndAdd(this)}),$(document).on("click","#products .product-item .cart-btn",function(){return a.addToCart(this,!0)}),$(document).on("click",c.find(".cart-item .delete").selector,function(){return a.update(this,"delete")}),$(document).on("click",c.find("#view-cart .delete-item").selector,function(){return a.update(this,"delete",!0)}),$(document).on("change","#products-cart-left .num-items",function(){return a.update(this)}),$(document).on("click",c.find("#view-cart .restore-item").selector,function(){return a.restoreItem(this)}),$(document).on("click",a.client_info.find(".btn-send").selector,function(){return $("#product-order-form").submit(),!1}),a.submitOrderForm(),$(document).on("change","#cart-inner #total-summ span",function(){return a.summDeliveryPrice($(this).html())}),$("#delivery-choose").find(".delivery-choose").change(function(){var a=$("input.delivery-choose:checked");$(".without-delivery").toggle(a.hasClass("delivery-type-2")),$(".with-delivery").toggle(!a.hasClass("delivery-type-2"));var b=parseInt(a.data("dlvr"));return $("#product-order-form").find("#dlvrId").val(b),$("#cart-inner").find("#total-summ span").trigger("change"),!1}),$(document).on("change","#product-params-view .ptype-view-select",function(){return a.updateProductCost(this)});var e=$("#promocode-form");$(document).on("click",e.find(".buttons").selector,function(){return a._checkPromoCode(this)}),$(document).on("change",e.find("input").selector,function(){return a._checkPromoCode(this)}),$("#product-order-form").find(".vertical-radio input:radio").prop("checked",!1),$(document).on("click","#view-cart input[type=radio]",function(){var a=$(this);"payments-14"==a.attr("id")?$("#qiwi_phone_container").show():$("#qiwi_phone_container").hide(),"payments-204"==a.attr("id")?$("#pscb_phone_container").show():$("#pscb_phone_container").hide()}),$.validator.addMethod("payment_qiwi_phone",function(a,b){return $("#payments-14").attr("checked")?(a=a.replace(/[^\d]/g,""),this.optional(b)||/^(7|8)\d{10}$/i.test(a)):!0},view.translate("Введите корректный номер QIWI кошелька")),$.validator.addMethod("phone",function(a,b){var c=a.trim();return this.optional(b)||/^[+]?(\d)+$/i.test(c)},view.translate("Только цифры и +. Пример: +79123456789")),$.validator.addMethod("payment_pscb_phone",function(a,b){return $("#payments-204").attr("checked")?(a=a.replace(/[^\d]/g,""),this.optional(b)||/^(7|8)\d{10}$/i.test(a)):!0},view.translate("Введите корректный номер ПСКБ кошелька")),$.validator.addMethod("onecheck",function(){return $("#accept_agreement:checked").length>=1},"Принять условия публичной оферты"),$(document).on("change",'.payments-step input[data-name="paymethod"]',function(){var a=$('input[data-name="paymethod"]:checked');if(a.length>0){var b=$(".payments-step .btn-send"),c=a.val();b.html(0==c||2==c||1==c?view.translate("Отправить заказ"):view.translate("Перейти к оплате")),b.removeClass("disable")}})},toCartStep:function(){var a=$(".contacts-step"),b=$(".cart-step"),c=$(".pay-step");c.find(".separate").removeClass("arrow_step_fl").removeClass("arrow_step_fr").addClass("arrow_step"),a.find(".separate").removeClass("arrow_step_fr").addClass("arrow_step_fl"),b.addClass("active"),a.removeClass("active"),c.removeClass("active"),$(".payments-step").hide(),this.client_info.hide(),this.order_info.show()},_checkPromoCode:function(){var a=$("#promocode-form").find("input").val(),b=this;return Cart.countUpdated=!0,$.post("/products/load/getdiscount",{code:a},function(c){try{void 0!=c&&1==c.success?(b.calculateSumm(c.promocode),$("#promocode").val(a),$("#total-discount-element").css("display","table-row")):0==c.success&&""!=c.messages&&(b.promocode=null,b.calculateSumm(),$("#total-discount-element").css("display","none"))}catch(d){ntNotification.showError("Произошла ошибка")}setTimeout(function(){Cart.countUpdated=!1,$(document).off("toContactStep")},10)},"json"),!1},grabParams:function(a){var b=[],c=$("#product-params-view");if(c.length>0){var d=c.find(".ptype-view-wrapper select");d.each(function(){var a=parseInt($(this).val());a>0&&b.push($(this).val())}),d.length==b.length?a(b):ntNotification.showWarning("Выберите все параметры",4e3)}else a(b)},grabParamsAndAdd:function(a){var b=this;b.grabParams(function(c){b.addToCart(a,!1,c)})},addToCart:function(a,b,c){var d=$(a).parents(1==b?".product-item":".item-content"),e=c||[];if(d.length>0){var f=$(d).attr("id").replace("item","")||0,g=b?void 0:a;this.push({itemId:f,num:1,getcart:1,button:g,productParams:e})}return!1},push:function(a){var b=this;return void 0!=a&&$.post(b.pushUrl,{cid:a.itemId,num:a.num,getcart:a.getcart||0,productParams:a.productParams},function(c){try{if(_.isUndefined(c)||1!=c.success){var d=void 0!=c.msg?c.msg:"Произошла ошибка, попробуйте  позже";throw new Error(d)}if(!_.isUndefined(c)){var e=$("<div>"+c.cart+"</div>").find("#"+b.blockLeft),f=$("#"+b.blockLeft);f.length>0?f.replaceWith(e):$(".cart-is-empty").replaceWith(e)}"restore"==a.action&&b.markItem(a.elementId,!0),a.callback&&a.callback(),void 0!=a.button&&Notifier.showNotice($(a.button).parent(),view.translate("Товар добавлен"),!0),$(document).trigger("cart.update")}catch(g){ntNotification.showError(g.message)}},"json"),!1},update:function(a,b,c){a=$(a);var d=this,e=b||"update",f=c||!1,g=f?a.parents("tr").eq(0).attr("id").replace("item",""):a.parents(".cart-item").eq(0).data("cid");if(Cart.countUpdated=!0,void 0!=g){var h={cid:g,act:e};if("update"==e){var i=a.val();if(!view.isInt(i)||0>i)return a.val(a.data("value")),Cart.countUpdated=!1,!1;0==i?h.act="delete":$.extend(h,{num:i})}$.post(d.updateUrl,h,function(b){try{if(void 0==b||1!=b.success){if(b.noProductInStock)return d.showNumErrors(b.noProductInStock),a.val(a.data("value")),void setTimeout(function(){Cart.countUpdated=!1,$(document).off("toContactStep")},10);void 0!=b.num&&a.val(a.data("value"));var c=b.msg||view.translate("Произошла ошибка, попробуйте  позже");throw new Error(c)}var g=a.data("pid"),j=a.data("price"),k=$("#cart-inner").find('.price-info[rel="product-'+g+'"]');switch(e){case"update":0==i&&(f?d.markItem(h.cid):d.removeItem(h.cid));var l=j*i;l=parseFloat(l.toFixed(2)),k.html(l),d.calculateSumm(),a.data("value",a.val());break;case"delete":f?d.markItem(h.cid):d.removeItem(h.cid)}$(document).trigger("cart.update")}catch(m){ntNotification.showError(m.message)}setTimeout(function(){Cart.countUpdated=!1,$(document).off("toContactStep")},10)},"json")}return!1},removeItem:function(a){$("#cid"+a).remove(),0==$("#"+this.blockLeft+" .cart-item").length&&$("#"+this.blockLeft).replaceWith('<div class="cart-is-empty">')},markItem:function(a,b){var c,d;if(void 0!=a){var e=b||!1,f=$("#item"+a);e?(c="delete-item",d=""):(c="restore-item",d="deleted-item"),f.find(".cart-manage span").attr("class",c),f.attr("class",d),this.calculateSumm()}return!1},restoreItem:function(a){var b=this,c=$(a).parents("tr.deleted-item").eq(0);if(c.length>0){var d=c.attr("id"),e={itemId:c.data("pid"),elementId:d.replace("item",""),action:"restore"},f=$("#"+d+" .num-items"),g=parseInt(f.val());0==g&&(g=1,f.val(1),e.callback=function(){b.update(f[0],"update",!0)}),e.num=g;var h=$(c).find(".product-params li"),i=[];h.length>0&&h.each(function(){i.push($(this).data("param"))}),e.productParams=i,this.push(e)}return!1},_calculateDiscount:function(a,b,c){var d,e=this,f=a.conditions,g=0;if(a.type==e.PROMOCODE_FORALL){for(d in f)g=f[d].discount;return parseFloat(c-parseFloat(c*parseFloat(g)/100)).toFixed(2)}if(a.type==e.PROMOCODE_PERCENT){for(d in f)c>parseFloat(f[d].condition)&&(g=parseFloat(f[d].discount));return parseFloat(c-parseFloat(c*parseFloat(g)/100)).toFixed(2)}if(a.type==e.PROMOCODE_CURRENCY){for(d in f)c>parseFloat(f[d].condition)&&(g=parseFloat(f[d].discount));return parseFloat(c-parseFloat(g)).toFixed(2)}if(a.type==e.PROMOCODE_ARTICUL){var h=$(b).data("articul"),i=$(b).val();for(d in f)if(f[d].discount==h&&""!=h)return g=parseFloat(f[d].condition),parseFloat(g*i)<parseFloat(c)?parseFloat(parseFloat(c)-parseFloat(g*i)).toFixed(2):parseFloat(c).toFixed(2)}return c},calculateSumm:function(a){var b=!0,c=this;void 0==a?a=c.promocode:c.promocode=a;var d=$("#cart-inner"),e=d.find("#total-summ span"),f=0,g=0;d.length>0&&(d.find('tr:not(".deleted-item") .product-summ').length?($(".cart-empty").hide(),$("#view-cart").find(".has_products").show()):($("#view-cart").find(".has_products").hide(),$(".cart-empty").show(),b=!1),d.find('tr:not(".deleted-item") .product-summ').each(function(){var b=$(this).html().replace("/[^d.]/",""),d=$(this).parent().parent().find("input");b=""!=b&&b>0?b:0,void 0!=a&&a.type==c.PROMOCODE_ARTICUL?(g+=parseFloat(b),f+=parseFloat(c._calculateDiscount(a,d,parseFloat(b)))):f+=parseFloat(b)})),void 0!=a&&a.type!=c.PROMOCODE_ARTICUL?(g=parseFloat(f).toFixed(2),f=c._calculateDiscount(a,null,parseFloat(f.toFixed(2)))):f=parseFloat(f).toFixed(2),$("#total-discount-element").find("#total-discount span").html(parseFloat(g-f).toFixed(2)),e.html(f),e.trigger("change");var h,i=$(".min-order-sum"),j=$(".btn-contact-step"),k=$(".shop-continue");i.length&&(h=i.data("min-sum"),h>f?(i.show(),k.show(),j.hide(),b=!1):(i.hide(),k.hide(),j.show())),b&&$(document).trigger("toContactStep")},summDeliveryPrice:function(a){var b=parseFloat(a),c=$("#delivery-choose");if(c.length>0){var d=c.find("input.delivery-choose:checked").val();if(void 0!=d&&b>0){var e=parseFloat(d.replace("/[^d.]/",""));c.find("#total-summ-order span").html((b+e).toFixed(2))}else c.find("#total-summ-order span").html(b.toFixed(2))}},getError:function(a,b){for(var c in a)if(a.hasOwnProperty(c)){if("object"==$.type(a[c]))return this.getError(a[c],c);var d={};return d.element=b,d.message=a[c],d}},showError:function(a,b,c){if(a.addClass("error"),!a.is('input[type="checkbox"]')){var d=$("<div class='error -text-error -pull-right -mg-l-10 error-message'>");d.text(b),c.find('label[for="'+a.attr("name")+'"]').append(d)}},deleteError:function(a,b,c){setTimeout(function(){a.removeClass("error"),b.find(".-text-error").remove()},c)},showNumErrors:function(a){var b,c,d,e,f=this,g=$("#products-cart-left-show");if(g.length)for(d in a)a.hasOwnProperty(d)&&(e=g.find("#cid"+d),c=e.find("input"),c.val(a[d]),c.addClass("error"),b=0!=a[d]?view.translate("Осталось")+": "+a[d]:view.translate("Нет в наличии"),e.append('<div style="margin-top: 3px" class="-text-error">'+b+"</div>"),f.deleteError(c,e,2e3));else for(d in a)a.hasOwnProperty(d)&&(c=$("#item"+d+" input.num-items"),c.addClass("error"),b=0!=a[d]?view.translate("Осталось")+": "+a[d]:view.translate("Нет в наличии"),e=c.parent(),e.append('<div class="-mg-t-10 -text-error">'+b+"</div>"),f.deleteError(c,e,2e3))},submitOrderForm:function(){var a=this,b=$(".payments-step"),c=b.find('input[type="radio"][name="payment"]'),d=$(this.orderForm);a.hasStore&&$(document).on("click",'.payments-step input[type="radio"]',function(){var a=parseInt(b.find('input[type="radio"]:checked').val()),c=b.find("label[for=accept_agreement]");0==a||2==a?c.hide():c.show()}),d.validate({submitHandler:function(f){return $(".payments-step .btn-send.disable").length?!1:(Notifier.showIndicatorBtn($(".btn-send")),void d.ajaxSubmit({dataType:"json",success:function(g){if(g.success)if(a.hasStore&&0==c.filter("#payments-0:checked, #payments-2:checked, #payments-1:checked").length){var h=$(g.form);if(h.hide(),$("#view-cart").append(h),c.length>0){var i=c.filter(":checked").val();h.find("#payment").val(i)}h.submit()}else window.location="/cart/checkout";else{if(Notifier.hideIndicatorBtn($(".btn-send")),g.noProductInStock)return a.toCartStep(),void a.showNumErrors(g.noProductInStock);if(g.message&&ntNotification.showError(g.message),g.errors){var j=a.getError(g.errors),k=$(f).find("#"+j.element);k.length>0?(a.hasStore&&b.find(".prev-step-contacts").trigger("click"),a.showError(k,j.message,d)):ntNotification.showError(e.message)}}}}))},showErrors:function(b,c){d.find(".error-message").remove(),$("input.error").removeClass("error");for(var e=0;e<c.length;e++){var f=c[e],g=$(f.element);a.showError(g,f.message,d)}},focusInvalid:!1,focusCleanup:!1,rules:{qiwi_phone:{required:!0,payment_qiwi_phone:!0},nhpay_phone:{required:!0,payment_pscb_phone:!0},accept_agreement:{onecheck:!0},name:{required:!0},email:{identity:!0,required:!0},phone:{required:!0,phone:!0}},messages:{qiwi_phone:{required:view.translate("Обязательное поле")},nhpay_phone:{required:view.translate("Обязательное поле")},comment:{maxlength:view.translate("Введено больше символов")},adress:{maxlength:view.translate("Введено больше символов")},name:{maxlength:view.translate("Введено больше символов"),required:view.translate("Обязательное поле")},email:{maxlength:view.translate("Введено больше символов"),required:view.translate("Обязательное поле"),email:view.translate("Неверный формат почты")},phone:{maxlength:view.translate("Введено больше символов"),required:view.translate("Обязательное поле")}}}),Visitor.bindInputCharCounter()},updateProductCost:function(){var a=$("#products-show"),b={price:a.find(".product-content .old-price .product-price-data"),priceSale:a.find(".product-content #cost-by-impact .product-price-data")},c={price:Number(b.price.data("cost")),priceSale:Number(b.priceSale.data("cost"))};c.priceSale>=0&&($("#product-params-view").find(".ptype-view-select").each(function(){var a=parseFloat($(this).find("option:selected").data("impact"));c.price+=a,c.priceSale+=a}),c.price=c.price>0?c.price:0,c.priceSale=c.priceSale>0?c.priceSale:0,b.price.html(parseFloat(c.price.toFixed(2))),b.priceSale.html(parseFloat(c.priceSale.toFixed(2))))}}),$("document").ready(function(){window.Nethouse=window.Nethouse||{},window.Nethouse.cart=new Cart});var Comments;$("document").ready(function(){Comments=function(){this.init()},Comments.prototype={init:function(){var a=this;this.id="comment",this.block_id=$("#"+this.id).data("block-id"),this.widget_type=7,this.countSubComments=2,this.page=2,this.showMessage="<span>"+view.translate("Показать все комментарии")+"</span>",this.hideMessage="<span>"+view.translate("Скрыть комментарии")+"</span>",$("#comment_wrap").length?a.initComments():$(document).on("widget_init",function(){a.initComments()}),this.loadEvents()},initComments:function(){var a=this,b=$("#comment_wrap"),c=b.attr("class");if(0!=$(".widget-comments .comment_wrap").length){var d=$(".widget-comments > .comment_wrap");a.count_roots=d.length,a.prepareOutput(d,!0),b.find(".next_comments").click(function(){a.getWidgetComments(this)})}$(document).on("changeBlock","#comment",function(){var b=$("#comment_wrap");if(0!=b.length&&b.is(":hidden")){var c=$(".widget-comments > .comment_wrap");a.prepareOutput(c,!0),$(".all-comments .answer-btn").click(function(){a.getAnswer(this)}),"undefined"!=typeof CommentsUser&&CommentsUser.reloadEvents()}}),void 0!=c?(this.type=c,this.object=b.find(".comment").attr("id")):this.type="site",0!=b.length&&0!=b.find(".is_scroll").length&&a.infiniteScroll()},loadEvents:function(){var a=this;$(document).on("click","#comment_wrap .addcomment",function(){var b=$("#form_wrap");return a._getSmallForm($(this),b,!1),!1}),$(document).on("click",".all-comments .answer-btn",function(){a.getAnswer(this)}),$(document).on("click",".fancybox-inner #comment_form .cancel",function(){var b=this;return $(b).parents("#comment_form").slideToggle(function(){a.hideFormAndRevalidate($(b))}),!1}),$(document).on("click",".all-comments .cancel, #comment_wrap .cancel",function(){return $(this).parents("#comment_form").hide(),$(this).parents(".answer-form").hide(),$(this).parents(".comment_wrap ").find(".up-arrow").hide(),a.hideFormAndRevalidate($(this)),!1}),$(document).on("click","#comment-edit .cancel, #comment-edit .close",function(){a.toggleBlock(a.id,"close")}),$(document).on("hideBlocks",function(){a.toggleBlock(a.id,"close")}),$(document).on("click","#comment .add-btn",function(){a.toggleBlock(a.id,"add");var b=$("#"+a.id+"-edit"),c=$("#"+a.id+" i.up-arrow");return $("i.up-arrow").remove(),c.length>0&&c.remove(),a._getSmallForm($(this),b,!1)}),$(document).on("click","#comment_form #reload",function(){a.reloadCaptcha()})},infiniteScroll:function(){var a=this;$(".end_comments").endlessScroll({fireOnce:!1,fireDelay:10,loader:"<img id='loader' src='/img/lazyload.gif'>",url:"/comment/load/getcomments",toElement:!0,params:{type:a.type,object:a.object,page:a.page},success:function(a,b){return a.success?(b.params.page++,a.next_page?$("#comment_wrap .is_scroll .per_page").html(a.count):(b.disable=!0,$("#comment_wrap .is_scroll").replaceWith('<h2 class="not_scroll">Комментарии</h2>')),a.output):!1},insertAfter:".all-comments article.comment_wrap:last",callback:function(){CommentsUser.reloadEvents()}})},prepareOutput:function(a,b){var c=this,d='<div class="button-show-'+c.id+' blue">'+c.showMessage+"</div>";a.each(function(){var a=$(this),e=a.find(".button-show-"+c.id),f=a.find(".comment_wrap");f.length>c.countSubComments?(0==e.length&&(a.children("div").after(d),a.find(".button-show-"+c.id).click(function(){c.showSubComments(this)})),(b||!e.hasClass("isshow"))&&(f.show(),a.find(".comment_wrap:lt("+(f.length-c.countSubComments)+")").hide())):0!=e.length&&(f.show(),e.remove())}),b&&($("#ajax-loader").remove(),$("#"+c.id+"_wrap").show())},showSubComments:function(a){$(".answer-form.comment_wrap").remove();var b=$("#comment-form");0!=b.length&&(b.parent().find(".item").show(),b.remove());var c=this,d=$(a);if(d.hasClass("isshow")){d.removeClass("isshow");var e=d.parent().find(".comment_wrap"),f=e.length;f>c.countSubComments&&(d.html(c.showMessage),d.parent().find(".comment_wrap:lt("+(f-c.countSubComments)+")").hide())}else d.addClass("isshow"),d.html(c.hideMessage),d.parent().find(".comment_wrap").show()},getAnswer:function(a){var b=this,c=$(a).parent().parent().find(".answer-form");if(1==c.length){var d=$(a).find("i.up-arrow");c.is(":visible")?(d.hide(),c.hide(),c.find("form").hide()):(c.show(),c.find("form").show(),0==d.length?$(a).append('<i class="up-arrow"></i>'):d.show())}else{var e=$(a).parent().attr("id").replace("item-",""),f=$('<article id="parent-'+e+'" class="answer-form"><div><div></article>');$(a).parent().after(f),$("i.up-arrow").remove(),0!=$("#comment-edit:visible").length&&($("#comment_form").remove(),b.toggleBlock(b.id,"add")),b._getSmallForm($(a),f,!0)}return!1},hideFormAndRevalidate:function(a){var b=this,c=$(a).parents("form"),d=0!=$(a).parents(".fancybox-inner").length,e=c.parent(),f=c.clone();e.append(f),c.remove(),d?b.validateWindowForm(f):"site"==b.type?b.validateWidgetForm(f):b.validateForm(f)},toggleBlock:function(a,b){$(".on-edit:not(.static)").hide(),$(".content-block").show(),$(".content-block").parents("section").addClass("on-view"),$("header.infoPlate").each(function(){0==$(this).parents("#"+a).length&&($(this).children(".edit-block").find("a").removeClass("active-btn"),$(this).find(".add-btn").removeClass("active-btn"))}),$("#header-wrapper .edit-block").find("a.active-btn").removeClass("active-btn"),$("#header-wrapper").attr("class","");var c=$("#"+a).hasClass("overt");if("edit"==b||"add"==b){var d="add"==b?"edit":"add";$("#"+a+" ."+b+"-btn").hasClass("active-btn")?($("#"+a+"-edit").hide(),$("#"+a+" .no-entry").show(),$("#"+a+"-show").show(),$("#"+a).addClass("on-view"),$("#"+a+" ."+b+"-btn").removeClass("active-btn")):($("#"+a+"-edit").show(),c||$("#"+a+"-show").hide(),$("#"+a+" .no-entry").hide(),$("#"+a).removeClass("on-view"),$("#"+a+" ."+b+"-btn").addClass("active-btn"),$("#"+a+" ."+d+"-btn").removeClass("active-btn"))}else $("#"+a+"-edit").hide(),$("#"+a+"-show").show(),$("#"+a+" .no-entry").show(),$("#"+a).addClass("on-view"),$("#"+a+" .edit-btn").removeClass("active-btn"),$("#"+a+" .add-btn").removeClass("active-btn");return void 0!=b||"contactsmain"!=a&&"contactssocnet"!=a||$("#content #"+a+"-form").remove(),!1},getWidgetComments:function(){var a=this,b="/comment/load/getsitecomments";$("#comment_wrap .next_comments span").hide(),$("#comment_wrap .next_comments").append("<img id='loader' src='/img/lazyload.gif'>"),$.post(b,{page:a.page},function(b){if($("#comment_wrap #loader").remove(),b.success){a.page++;var c=$(b.output);a.prepareOutput(c),$(".all-comments.widget-comments").append(c),"undefined"!=typeof CommentsUser&&CommentsUser.reloadEvents(),c.find(".answer-btn").click(function(){a.getAnswer(this)}),b.next_page?$("#comment_wrap .next_comments span").show():$("#comment_wrap .next_comments").remove()}else $("#comment_wrap .next_comments span").show(),ntNotification.showError("Произошла ошибка")},"json")},_getSmallForm:function(a,b,c){var d=this;if($(".comment_wrap.answer-form").not(b).remove(),$("#comment_form").parents(".answer-form").remove(),$("section#comment #comment-edit #comment_form").remove(),$(".comment_wrap #comment_form").remove(),$(".comment_wrap .item").show(),c)var e=a.parent().attr("id").replace("item-","");if(a.hasClass("active-btn")||"site"!=d.type||c){"site"==d.type&&a.append('<i class="up-arrow"></i>');var f=Notifier.getLoader();b.html('<div class="ajax-loader">'+f+"</div>");var g="/"+d.id+"/load/getform";$.post(g,{type:d.type,object:d.object,parent:e},function(c){try{if(!c.success){$("#"+d.id+" .no-entry").show();var e=$(c.form).closest(".block-error").length>0?form:"Ошибка";throw new Error(e)}$("."+d.id+"_wrap #"+d.id+"_form").remove();var f=b.html(c.form);"site"==d.type?(f.children("form").removeClass("fromTable").addClass("new-item"),d.validateWidgetForm(f.children("form"))):(d.ReloadEvents(a),d.validateForm(f.children("form")))}catch(g){$("#comment-edit").empty(),Notifier.showError(g.message,"#comment-edit")}},"json")}return!1},ReloadEvents:function(a){var b=this;a.unbind("click"),a.click(function(){$(".comment_wrap #comment_form").remove(),$(".comment_wrap .item").show();var a=$("#comment_form");a.is(":hidden")?(b.reloadCaptcha(),a.show()):a.hide()})},highlight:function(a,b){$(a).addClass(b)},unhighlight:function(a,b){$(a).removeClass(b).next(".errors")},showErrors:function(a,b){$("#comment_form .errors").remove(),$("#comment_form .error").removeClass("error");for(var c=0;c<b.length;c++){var d=b[c],e=$(d.element),f=$('<ul class="errors">');f.append($("<li>").text(d.message)),f.insertAfter(e.hasClass("cleditor")?e.parents(".cleditorMain").find("iframe"):e),this.settings.highlight.call(this,d.element,"error")}},validateWindowForm:function(a){var b=this;a.validate({showErrors:b.showErrors,unhighlight:b.unhighlight,highlight:b.highlight,submitHandler:function(a){return Notifier.showIndicator("comment_form",!1),$(a).ajaxSubmit({dataType:"json",success:function(a){Notifier.hideIndicator("comment_form",!1),a.success?(a.isNew?($(".fancybox-inner .all-comments").append(a.comment),0==$("#comment_wrap header .info h2").length&&$("#comment_wrap header .info").append('<h2 class="not_scroll">Комментарии</h2><div class="bold_sep"><hr></div>'),b.cleanForm()):$(".fancybox-inner .all-comments #item-"+a.item).parent().replaceWith(a.comment),"undefined"!=typeof CommentsUser?CommentsUser.reloadEvents():b.reloadCaptcha()):a.captchaFaild?(b.reloadCaptcha(),b.captchaError()):($(".comment_wrap .item").show(),ntNotification.showError("Произошла ошибка"))},beforeSubmit:function(){Notifier.showIndicator("comment_wrap",!1)}}),!1},rules:b.rules,messages:b.messages,focusInvalid:!1,focusCleanup:!0})},validateForm:function(a){var b=this;a.validate({showErrors:b.showErrors,unhighlight:b.unhighlight,highlight:b.highlight,submitHandler:function(a){return Notifier.showIndicator("comment_form",!1),$(a).ajaxSubmit({dataType:"json",success:function(a){if(Notifier.hideIndicator("comment_form",!1),a.success){if($("#comment_form").hide(),a.isNew){if($("#comment_wrap .all-comments").prepend(a.comment),b.cleanForm(),0!=$("#comment_wrap .no-comments").length)$("#comment_wrap .no-comments").replaceWith('<h2 class="not_scroll">Комментарии</h2>'),$("#comment_wrap .bold_sep").html("<hr/>");else if(0!=$("#comment_wrap .is_scroll").length){var c=$("#comment_wrap .is_scroll .per_page"),d=$("#comment_wrap .is_scroll .total"),e=parseInt(c.text())+1,f=parseInt(d.text())+1;d.html(f),c.html(e)}}else $(".all-comments #item-"+a.item).parent().replaceWith(a.comment);
"undefined"!=typeof CommentsUser&&CommentsUser.reloadEvents()}else a.captchaFaild?(b.reloadCaptcha(),b.captchaError()):($(".comment_wrap .item").show(),ntNotification.showError("Произошла ошибка"))},beforeSubmit:function(){Notifier.showIndicator("comment_wrap",!1)}}),!1},rules:b.rules,messages:b.messages,focusInvalid:!1,focusCleanup:!0}),Visitor.bindInputCharCounter()},validateWidgetForm:function(a){var b=this;a.validate({showErrors:b.showErrors,unhighlight:b.unhighlight,highlight:b.highlight,submitHandler:function(a){return Notifier.showIndicator("comment_form",!1),$(a).ajaxSubmit({dataType:"json",success:function(a){if(Notifier.hideIndicator("comment_form",!1),a.success){if(a.isNew){$("#comment_form").parent().hide(),$("i.up-arrow").remove(),$("#comment .no-entry").remove();var c=$(a.comment);if(a.parent){var d=$("#comment .all-comments #item-"+a.parent).parent();d.append(c),b.prepareOutput(d,!1)}else b.toggleBlock(b.id,"add"),c.find(".answer-btn").click(function(){b.getAnswer(this)}),$("#comment .all-comments").prepend(c);b.cleanForm(),"undefined"==typeof CommentsUser&&b.reloadCaptcha()}else{var e=$("#comment .all-comments #item-"+a.item);e.parent().find("#comment_form").remove();var c=$(a.comment);c.find(".answer-btn").click(function(){b.getAnswer(this)}),e.replaceWith(c)}"undefined"!=typeof CommentsUser&&CommentsUser.reloadEvents()}else a.captchaFaild?(b.reloadCaptcha(),b.captchaError()):($(".comment_wrap .item").show(),ntNotification.showError("Произошла ошибка"))},beforeSubmit:function(){Notifier.showIndicator("comment_wrap",!1)}}),!1},rules:b.rules,messages:b.messages,focusInvalid:!1,focusCleanup:!0}),Visitor.bindInputCharCounter()},captchaError:function(){$("#comment_form #captcha-input").val("").addClass("error"),$("#comment_form #captcha-element").append('<ul class="errors"><li>'+view.translate("Неверно введены символы, указанные на картинке.")+"</li></ul>")},cleanForm:function(){$('#comment_form input[type="text"], #comment_form textarea').val(""),$("#comment_form #captcha-input").val("")},rules:{name:{required:!0,maxlength:40},commenttext:{required:!0,maxlength:1024},"captcha[input]":{required:!0,minlength:6,maxlength:6}},messages:{name:{required:view.translate("Обязательное поле"),maxlength:view.translate("Максимальная длина")+" 40 "+view.translate("символов")},commenttext:{required:view.translate("Обязательное поле"),maxlength:view.translate("Максимальная длина")+" 1024 "+view.translate("символов")},"captcha[input]":{required:view.translate("Обязательное поле"),maxlength:view.translate("Введено не")+" 6 "+view.translate("символов"),minlength:view.translate("Введено не")+" 6 "+view.translate("символов")}},reloadCaptcha:function(){"undefined"==typeof CommentsUser&&$.post("/comment/load/captcha",function(a){a.success?($("#comment_form #captcha-element img").attr("src",a.image),$("#comment_form #captcha-id").val(a.captcha)):ntNotification.showError("Произошла ошибка")},"json")}},Comments=new Comments}),function(a,b){"use strict";a(document).on("click",".window .cancel, .window .close",function(){return a.magnificPopup.close(),!1});var c={openHtmlAjax:function(c,d){d=d||{},d.loaded=d.loaded||function(){},d.open=d.open||function(){},a.magnificPopup.open({tLoading:'<img src="/img/preloader.gif">',items:{type:"ajax",src:c},ajax:{settings:d.opts,tError:d.error},removalDelay:300,mainClass:"mfp-fade",showCloseBtn:!1,callbacks:{parseAjax:function(a){d.loaded(a,this)},ajaxContentAdded:function(){a(".mfp-content").addClass("site-popup"),d.open()},close:function(){b.history.pushState("",document.title,b.location.pathname)}}})},openHtml:function(c){this.hideLoader(),a.magnificPopup.open({tLoading:'<img src="/img/preloader.gif">',items:{src:c,type:"inline"},removalDelay:300,mainClass:"mfp-fade",showCloseBtn:!1,callbacks:{open:function(){a(".mfp-content").addClass("site-popup")},close:function(){b.location.pushState("",document.title,b.location.pathname)}}})},showLoader:function(){a("body").prepend('<div class="-screen-loader"><div><div class="-screen-loader-img"><img src="/img/preloader.gif"></div></div></div>')},hideLoader:function(){a("body > .-screen-loader").remove()},close:function(){a.magnificPopup.close()}};b.Nethouse=b.Nethouse||{},b.Nethouse.Modal=c}(window.$,window);var ntNotification={templates:{},notifications:[],getTemplate:function(a,b){var c=this;this.templates[a]?b(c.templates[a]):$.get("/html/ru_RU/utils/notification.html",function(d){c.templates[a]=d,b(c.templates[a])})},getTop:function(a){return parseInt(a.css("top").replace("px",""))},changeTop:function(){var a=this,b=a.topElement.height(),c=$(window).scrollTop();a.notification_box.css(b-c>0?{top:b-c+"px"}:{top:0})},topElement:null,moveAll:function(a,b){var c=this;_.forEach(c.notifications,function(d,e){if(e>=a)if(a!=e){var f=c.notifications[e-1].elm;b=b+f.outerHeight()+5,d.elm.animate({top:b+"px"},200)}else d.elm.animate({top:b+"px"},200)})},deleteNotification:function(a,b){var c=this,d=_.indexOf(c.notifications,a),e=c.getTop(a.elm);a.timeout&&clearTimeout(a.timeout),c.notifications=_.without(c.notifications,a),a.elm.stop(!0,!0),b?a.elm.animate({left:a.elm.width()+"px",opacity:0},200,function(){a.elm.remove(),c.moveAll(d,e)}):a.elm.animate({top:e-a.elm.outerHeight()+"px",opacity:0},200,function(){a.elm.remove(),c.moveAll(d,e)})},shake:function(a){for(var b=70,c=5,d=5,e=0;d+1>e;e++)$(a).animate({"margin-left":e%2==0?c:-1*c},{duration:b,queue:!0});$(a).animate({"margin-left":0},b)},getPageX:function(a){var b=0;if("touchstart"==a.type||"touchmove"==a.type||"touchend"==a.type||"touchcancel"==a.type){var c=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];b=c.pageX}else("mousedown"==a.type||"mouseup"==a.type||"mousemove"==a.type||"mouseover"==a.type||"mouseout"==a.type||"mouseenter"==a.type||"mouseleave"==a.type)&&(b=a.pageX);return b},show:function(a,b,c){var d=this,e=CryptoJS.SHA1(b).toString(),f=_.findWhere(d.notifications,{id:e}),g=!_.isUndefined(c)&&c;if(f){if(f.elm.stop(!0,!0),d.shake(f.elm),f.timeout){clearTimeout(f.timeout);var h=f.elm.find(".-notification-timer");h.stop(!0,!0),h.css({width:""}),h.animate({width:0},f.time),f.timeout=setTimeout(function(){d.deleteNotification(f)},f.time)}}else this.getTemplate(a,function(f){window.view&&window.view.translate&&(b=window.view.translate(b));var h={id:e,elm:$(_.template(f)({type:a,message:b,hasTimer:g}))};if(h.elm.data("id",e),d.notification_box||(d.notification_box=$('<div class="-notification-box"></div>'),$(document).on("click",".-notification-close, .-notification-box .-notification-icon",function(){var a=_.findWhere(d.notifications,{id:$(this).parent().eq(0).data("id")});a&&d.deleteNotification(a)}),$(document).on("touchstart",".-notification",function(a){var b=_.findWhere(d.notifications,{id:$(this).data("id")});b.elm.css("left",0);var c=d.getPageX(a),e=b.elm.offset();$(document).on("touchmove.notification",function(a){var f=d.getPageX(a),g=f-c;g>0?b.elm.css({left:g+"px"}):e.left<f?c=f:$(document).off("touchmove.notification touchend.notification"),g>100&&($(document).off("touchmove.notification touchend.notification"),d.deleteNotification(b,!0))}),$(document).on("touchend.notification",".-notification",function(){b.elm&&b.elm.css({left:0}),$(document).off("touchmove.notification touchend.notification")})}),d.topElement=$("#header"),d.topElement.length?($(document).on("scroll",function(){d.changeTop()}),d.changeTop()):d.notification_box.css({top:0}),$("body").append(d.notification_box)),h.elm.css({opacity:0,top:0}),d.notification_box.append(h.elm),0!=d.notifications.length){5==d.notifications.length&&d.deleteNotification(d.notifications[d.notifications.length-1]);var i,j=function(){};_.forEach(d.notifications,function(a,b){if(b==d.notifications.length-1&&(j=function(){h.elm.animate({opacity:1},{duration:100,queue:!0})}),0!=b){var c=d.notifications[b-1].elm;i=i+c.outerHeight()+5,a.elm.animate({top:i+"px"},100,j)}else i=h.elm.outerHeight()+5,a.elm.animate({top:i+"px"},100,j)})}else h.elm.animate({opacity:1},100);d.notifications.unshift(h),g&&(h.time=c,h.elm.find(".-notification-timer").animate({width:0},c),h.timeout=setTimeout(function(){d.deleteNotification(h)},h.time))})},showError:function(a,b){b=_.isUndefined(b)?5e3:b,this.showMessage(a,"error",b)},showWarning:function(a,b){b=b===!0&&5e3||b,this.showMessage(a,"warning",b)},showSuccess:function(a,b){b=_.isUndefined(b)?5e3:b,this.showMessage(a,"success",b)},showMessage:function(a,b,c){var d=this;if(b=b||"error",c=_.isUndefined(c)?"warning"==b?0:5e3:c,/^\/[a-z]+/.test(a)){var e=$("body").data("lang");$.get("/html/"+e+a,function(a){d.show(b,a,c)})}else d.show(b,a,c)}};!function(a,b,c,d,e){"use strict";a.validator.addMethod("cMaxlength",a.validator.methods.maxlength,d.translate("Длина поля должна быть до {0} символов")),a.validator.addMethod("cRequired",a.validator.methods.required,d.translate("Обязательное поле")),a.validator.addMethod("phone",function(a,b){var c=a.trim();return this.optional(b)||/^[+]?(\d)+$/i.test(c)},d.translate("Только цифры и +. Пример: +79123456789")),a.validator.addClassRules({"dynamic-form-required":{cRequired:!0},"dynamic-form-text":{cMaxlength:100},"dynamic-form-textarea":{cMaxlength:1e3},"dynamic-form-phone":{phone:!0},"dynamic-form-email":{identity:!0}});var f=function(a,b){this.type=a,this.options=b||{},this.selector=".dynamic-form-"+a,this.btnSelector=".dynamic-form-button-"+a};b.extend(f,{formIsShow:function(b){a(document).trigger("dynamic-form-show."+b)},types:{FORM_TYPE_FEEDBACK:0,FORM_TYPE_CALLBACK:1,FORM_TYPE_ORDER:2,FORM_TYPE_LEAD:3},tooltipError:{trigger:"custom",theme:"tooltipster-error",speed:0,positionTracker:!0,offsetY:-6,position:"top"}}),b.extend(f.prototype,{init:function(){a(document).on("dynamic-form-show."+this.type,function(){e.setTimeout(function(){this.addButtonEvent(),this.validateForm()}.bind(this),100)}.bind(this)),this.addButtonEvent(),this.validateForm()},destroy:function(){a(document).off("dynamic-form-show."+this.type),a(this.btnSelector).off("click")},addButtonEvent:function(){a(this.btnSelector).on("click",function(){a(this.selector).submit()}.bind(this))},validateForm:function(){var e=a(this.selector),g=this;e.validate({submitHandler:function(){"function"==typeof g.options.beforeSubmit&&g.options.beforeSubmit(),e.ajaxSubmit({dataType:"json",success:function(a){if("function"==typeof g.options.afterSubmit&&g.options.afterSubmit(a),!a.success){var b=a.msg||d.translate("Ошибка при отправке формы");return void c.showError(b)}e[0].reset(),c.showSuccess(d.translate("Форма успешно отправлена"))}})},focusInvalid:!1,focusCleanup:!1,showErrors:function(c,d){var g=e.find("input, textarea");g.each(function(){var b=a(this);b.removeClass("error").addClass("valid"),b.hasClass("tooltipstered")&&b.tooltipster("hide")}),b.forEach(d,function(b){var c=a(b.element);c.hasClass("tooltipstered")||c.tooltipster(f.tooltipError),c.tooltipster("content",b.message),c.tooltipster("show"),c.removeClass("valid").addClass("error")})}})}}),e.Nethouse=e.Nethouse||{},e.Nethouse.DynamicForm=f}(window.$,window._,window.ntNotification,window.view,window),function(a,b){"use strict";a(document).ready(function(){var a=new b(b.types.FORM_TYPE_LEAD);a.init()})}(window.$,window.Nethouse.DynamicForm),function(a){"use strict";var b={init:function(){this.initBusinessPopup(),this.addMobileSelector()},sanitize:function(){var b=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;a(document).on("input paste",'textarea, input[type="text"]',function(){var c=a(this),d=c.val();d=d.replace(b,""),c.val(d)})},initBusinessPopup:function(){var b=a(".business-link"),c=function(){return"visible"===a(".business-popup-container").css("visibility")};a("body").click(function(d){var e=a(d.target);e.parents(".user-menu .business").length>0||!c()||b.click()}),a(".business-popup-container .popup-button > a").click(function(){b.click()})},addMobileSelector:function(){isMobile.any===!0&&a("body").addClass("mobile-device")}};a(document).ready(function(){b.init()})}(jQuery);